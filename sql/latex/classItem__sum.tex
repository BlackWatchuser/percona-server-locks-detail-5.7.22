\hypertarget{classItem__sum}{}\section{Item\+\_\+sum Class Reference}
\label{classItem__sum}\index{Item\+\_\+sum@{Item\+\_\+sum}}


{\ttfamily \#include $<$item\+\_\+sum.\+h$>$}

Inheritance diagram for Item\+\_\+sum\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.130678cm]{classItem__sum}
\end{center}
\end{figure}
\subsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classItem__sum_aab1364c0f2d629b6fbe83380ecdb3693}\label{classItem__sum_aab1364c0f2d629b6fbe83380ecdb3693}} 
enum {\bfseries Sumfunctype} \{ \newline
{\bfseries C\+O\+U\+N\+T\+\_\+\+F\+U\+NC}, 
{\bfseries C\+O\+U\+N\+T\+\_\+\+D\+I\+S\+T\+I\+N\+C\+T\+\_\+\+F\+U\+NC}, 
{\bfseries S\+U\+M\+\_\+\+F\+U\+NC}, 
{\bfseries S\+U\+M\+\_\+\+D\+I\+S\+T\+I\+N\+C\+T\+\_\+\+F\+U\+NC}, 
\newline
{\bfseries A\+V\+G\+\_\+\+F\+U\+NC}, 
{\bfseries A\+V\+G\+\_\+\+D\+I\+S\+T\+I\+N\+C\+T\+\_\+\+F\+U\+NC}, 
{\bfseries M\+I\+N\+\_\+\+F\+U\+NC}, 
{\bfseries M\+A\+X\+\_\+\+F\+U\+NC}, 
\newline
{\bfseries S\+T\+D\+\_\+\+F\+U\+NC}, 
{\bfseries V\+A\+R\+I\+A\+N\+C\+E\+\_\+\+F\+U\+NC}, 
{\bfseries S\+U\+M\+\_\+\+B\+I\+T\+\_\+\+F\+U\+NC}, 
{\bfseries U\+D\+F\+\_\+\+S\+U\+M\+\_\+\+F\+U\+NC}, 
\newline
{\bfseries G\+R\+O\+U\+P\+\_\+\+C\+O\+N\+C\+A\+T\+\_\+\+F\+U\+NC}, 
{\bfseries J\+S\+O\+N\+\_\+\+A\+G\+G\+\_\+\+F\+U\+NC}
 \}
\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classItem__sum_aca14d38d7bb89085ac4472ce4350a5b2}\label{classItem__sum_aca14d38d7bb89085ac4472ce4350a5b2}} 
bool {\bfseries has\+\_\+force\+\_\+copy\+\_\+fields} () const
\item 
\mbox{\Hypertarget{classItem__sum_a924bf27cfaf66cfcf1a76a816e8f47b2}\label{classItem__sum_a924bf27cfaf66cfcf1a76a816e8f47b2}} 
bool {\bfseries has\+\_\+with\+\_\+distinct} () const
\item 
\mbox{\Hypertarget{classItem__sum_acb41146ee1289cefbc30fabaeee43a47}\label{classItem__sum_acb41146ee1289cefbc30fabaeee43a47}} 
void {\bfseries mark\+\_\+as\+\_\+sum\+\_\+func} ()
\item 
\mbox{\Hypertarget{classItem__sum_a4bf026176ae23ef65a3ecf00699e2c21}\label{classItem__sum_a4bf026176ae23ef65a3ecf00699e2c21}} 
void {\bfseries mark\+\_\+as\+\_\+sum\+\_\+func} (st\+\_\+select\+\_\+lex $\ast$)
\item 
\mbox{\Hypertarget{classItem__sum_a0f8ebe329a61b4ce86480a9af7889b8e}\label{classItem__sum_a0f8ebe329a61b4ce86480a9af7889b8e}} 
{\bfseries Item\+\_\+sum} (const \mbox{\hyperlink{structYYLTYPE}{P\+OS}} \&pos)
\item 
\mbox{\Hypertarget{classItem__sum_ab37017d1c1c59664864a89a9935969dd}\label{classItem__sum_ab37017d1c1c59664864a89a9935969dd}} 
{\bfseries Item\+\_\+sum} (\mbox{\hyperlink{classItem}{Item}} $\ast$a)
\item 
\mbox{\Hypertarget{classItem__sum_a70dd65b9202678f0a1298c7825125492}\label{classItem__sum_a70dd65b9202678f0a1298c7825125492}} 
{\bfseries Item\+\_\+sum} (const \mbox{\hyperlink{structYYLTYPE}{P\+OS}} \&pos, \mbox{\hyperlink{classItem}{Item}} $\ast$a)
\item 
\mbox{\Hypertarget{classItem__sum_a50db265a8ee3dadf26dd78555fcf8acf}\label{classItem__sum_a50db265a8ee3dadf26dd78555fcf8acf}} 
{\bfseries Item\+\_\+sum} (const \mbox{\hyperlink{structYYLTYPE}{P\+OS}} \&pos, \mbox{\hyperlink{classItem}{Item}} $\ast$a, \mbox{\hyperlink{classItem}{Item}} $\ast$b)
\item 
\mbox{\Hypertarget{classItem__sum_a750ba5d0fc44f789b0da26f49ac4735f}\label{classItem__sum_a750ba5d0fc44f789b0da26f49ac4735f}} 
{\bfseries Item\+\_\+sum} (const \mbox{\hyperlink{structYYLTYPE}{P\+OS}} \&pos, \mbox{\hyperlink{classPT__item__list}{P\+T\+\_\+item\+\_\+list}} $\ast$opt\+\_\+list)
\item 
\mbox{\hyperlink{classItem__sum_ab22d52290db63c5048f1aa712be2cad7}{Item\+\_\+sum}} (T\+HD $\ast$thd, \mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}} $\ast$item)
\item 
virtual bool \mbox{\hyperlink{classItem__sum_ab44941149d918895e5f58ae94d3cd909}{itemize}} (\mbox{\hyperlink{structParse__context}{Parse\+\_\+context}} $\ast$pc, \mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$res)
\item 
\mbox{\Hypertarget{classItem__sum_a5b8e6e36d44d293008328ba1ee68603b}\label{classItem__sum_a5b8e6e36d44d293008328ba1ee68603b}} 
enum Type {\bfseries type} () const
\item 
\mbox{\Hypertarget{classItem__sum_aed1d2a2c7b4239179501cf8077ad4c3d}\label{classItem__sum_aed1d2a2c7b4239179501cf8077ad4c3d}} 
virtual enum Sumfunctype {\bfseries sum\+\_\+func} () const =0
\item 
bool \mbox{\hyperlink{classItem__sum_a5d29c1ad81ae5e0193775cb360f4a74a}{reset\+\_\+and\+\_\+add}} ()
\item 
\mbox{\Hypertarget{classItem__sum_a8389f10b8d24086cf3a3177b40b84378}\label{classItem__sum_a8389f10b8d24086cf3a3177b40b84378}} 
virtual void {\bfseries reset\+\_\+field} ()=0
\item 
\mbox{\Hypertarget{classItem__sum_a6b214bf6962a21455aaa537f5833e226}\label{classItem__sum_a6b214bf6962a21455aaa537f5833e226}} 
virtual void {\bfseries update\+\_\+field} ()=0
\item 
\mbox{\Hypertarget{classItem__sum_a4df4292b37087da6985283709a40f80d}\label{classItem__sum_a4df4292b37087da6985283709a40f80d}} 
virtual bool {\bfseries keep\+\_\+field\+\_\+type} (void) const
\item 
\mbox{\Hypertarget{classItem__sum_a2d853210c9caea36d360ad57fb6b3832}\label{classItem__sum_a2d853210c9caea36d360ad57fb6b3832}} 
virtual void {\bfseries fix\+\_\+length\+\_\+and\+\_\+dec} ()
\item 
\mbox{\Hypertarget{classItem__sum_a0d3f5893bf56f30e06bc88684ce00e89}\label{classItem__sum_a0d3f5893bf56f30e06bc88684ce00e89}} 
virtual \mbox{\hyperlink{classItem}{Item}} $\ast$ {\bfseries result\+\_\+item} (\mbox{\hyperlink{classField}{Field}} $\ast$field)
\item 
\mbox{\Hypertarget{classItem__sum_ad128a276280e0afe72ccb0e393dab235}\label{classItem__sum_ad128a276280e0afe72ccb0e393dab235}} 
table\+\_\+map {\bfseries used\+\_\+tables} () const
\item 
\mbox{\Hypertarget{classItem__sum_aaab945bdb327a02540a0b9c6030ff026}\label{classItem__sum_aaab945bdb327a02540a0b9c6030ff026}} 
void {\bfseries update\+\_\+used\+\_\+tables} ()
\item 
\mbox{\Hypertarget{classItem__sum_a34d803f255ce76bcd00d58ef3323cc15}\label{classItem__sum_a34d803f255ce76bcd00d58ef3323cc15}} 
bool {\bfseries is\+\_\+null} ()
\item 
\mbox{\Hypertarget{classItem__sum_a50f352c59bf4d0305bffda80520f70f8}\label{classItem__sum_a50f352c59bf4d0305bffda80520f70f8}} 
void {\bfseries make\+\_\+const} ()
\item 
\mbox{\Hypertarget{classItem__sum_a454fccc1e0e4e9e1e30b3c1c9eb6150a}\label{classItem__sum_a454fccc1e0e4e9e1e30b3c1c9eb6150a}} 
virtual bool {\bfseries const\+\_\+item} () const
\item 
\mbox{\Hypertarget{classItem__sum_adcd0bfb9d2e2c48570903e6c52b7cccf}\label{classItem__sum_adcd0bfb9d2e2c48570903e6c52b7cccf}} 
virtual bool {\bfseries const\+\_\+during\+\_\+execution} () const
\item 
virtual void \mbox{\hyperlink{classItem__sum_a0c176fad01253e4a168d0956eb1f6fc5}{print}} (String $\ast$str, enum\+\_\+query\+\_\+type query\+\_\+type)
\item 
\mbox{\Hypertarget{classItem__sum_aa89090ccb5f49afc194007e95ac2eb4c}\label{classItem__sum_aa89090ccb5f49afc194007e95ac2eb4c}} 
void {\bfseries fix\+\_\+num\+\_\+length\+\_\+and\+\_\+dec} ()
\item 
bool \mbox{\hyperlink{classItem__sum_aeab749252b834e0be4f00aac8ca523f5}{eq}} (const \mbox{\hyperlink{classItem}{Item}} $\ast$item, bool binary\+\_\+cmp) const
\item 
virtual void \mbox{\hyperlink{classItem__sum_aba62f301a61ca3e686abf23e109bb0a8}{no\+\_\+rows\+\_\+in\+\_\+result}} ()
\item 
\mbox{\Hypertarget{classItem__sum_a551fb0c43e28ae3088d71625d47c23f8}\label{classItem__sum_a551fb0c43e28ae3088d71625d47c23f8}} 
virtual void {\bfseries make\+\_\+unique} ()
\item 
\mbox{\Hypertarget{classItem__sum_aa1c5a95d9e25a0b4ec6775eb9d13ecbf}\label{classItem__sum_aa1c5a95d9e25a0b4ec6775eb9d13ecbf}} 
virtual \mbox{\hyperlink{classField}{Field}} $\ast$ {\bfseries create\+\_\+tmp\+\_\+field} (bool group, \mbox{\hyperlink{structTABLE}{T\+A\+B\+LE}} $\ast$table)
\item 
bool \mbox{\hyperlink{classItem__sum_ae323b192d183b3f85bbee92c43685310}{walk}} (Item\+\_\+processor processor, \mbox{\hyperlink{classItem_a4e68f315ba2a26543339e9f0efed3695}{enum\+\_\+walk}} walk, uchar $\ast$arg)
\item 
virtual bool \mbox{\hyperlink{classItem__sum_a838d698110f5c45d6ad3ba1c6e5b2a95}{clean\+\_\+up\+\_\+after\+\_\+removal}} (uchar $\ast$arg)
\item 
virtual bool \mbox{\hyperlink{classItem__sum_acc4dbcc4a2da3750ff11bf372fd973f5}{aggregate\+\_\+check\+\_\+group}} (uchar $\ast$arg)
\item 
virtual bool \mbox{\hyperlink{classItem__sum_a469f9e37bdb5f0c186b4fc2190f01fdb}{aggregate\+\_\+check\+\_\+distinct}} (uchar $\ast$arg)
\item 
bool \mbox{\hyperlink{classItem__sum_a34894a53489b9c2757491908222208bd}{init\+\_\+sum\+\_\+func\+\_\+check}} (T\+HD $\ast$thd)
\item 
bool \mbox{\hyperlink{classItem__sum_a6de4d25ee11eb43798effbd4968236bd}{check\+\_\+sum\+\_\+func}} (T\+HD $\ast$thd, \mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$ref)
\item 
bool \mbox{\hyperlink{classItem__sum_a15a75b6a683912f8222f7091b3714ec8}{register\+\_\+sum\+\_\+func}} (T\+HD $\ast$thd, \mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$ref)
\item 
\mbox{\Hypertarget{classItem__sum_add3e06f8ee2cbae4f1eb1ef3c662c21a}\label{classItem__sum_add3e06f8ee2cbae4f1eb1ef3c662c21a}} 
st\+\_\+select\+\_\+lex $\ast$ {\bfseries depended\+\_\+from} ()
\item 
\mbox{\Hypertarget{classItem__sum_ab8a61e6787ef93f6a5f348971426402b}\label{classItem__sum_ab8a61e6787ef93f6a5f348971426402b}} 
\mbox{\hyperlink{classItem}{Item}} $\ast$ {\bfseries get\+\_\+arg} (uint i)
\item 
\mbox{\Hypertarget{classItem__sum_acdfbfe05103c88d3d1ffefe1cf12afc3}\label{classItem__sum_acdfbfe05103c88d3d1ffefe1cf12afc3}} 
\mbox{\hyperlink{classItem}{Item}} $\ast$ {\bfseries set\+\_\+arg} (uint i, T\+HD $\ast$thd, \mbox{\hyperlink{classItem}{Item}} $\ast$new\+\_\+val)
\item 
\mbox{\Hypertarget{classItem__sum_af43910f5fe7afb9aee7b05581db7301f}\label{classItem__sum_af43910f5fe7afb9aee7b05581db7301f}} 
uint {\bfseries get\+\_\+arg\+\_\+count} () const
\item 
\mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$ \mbox{\hyperlink{classItem__sum_ae446ff1dc1d0a43af8a3b57861512d58}{get\+\_\+arg\+\_\+ptr}} (uint i)
\item 
\mbox{\Hypertarget{classItem__sum_a2f367d4660a3ccec53fd4d0efb925b17}\label{classItem__sum_a2f367d4660a3ccec53fd4d0efb925b17}} 
void {\bfseries init\+\_\+aggregator} ()
\item 
bool \mbox{\hyperlink{classItem__sum_ac84fa680a8b3690c6735474c9476f312}{aggregator\+\_\+setup}} (T\+HD $\ast$thd)
\item 
void \mbox{\hyperlink{classItem__sum_a15e7047e85571842d5aada49784f4278}{aggregator\+\_\+clear}} ()
\item 
bool \mbox{\hyperlink{classItem__sum_ab090330ed58167234556e1f906976c0c}{aggregator\+\_\+add}} ()
\item 
\mbox{\Hypertarget{classItem__sum_ab6d6dadc286edb069d017f4e24dbaa3e}\label{classItem__sum_ab6d6dadc286edb069d017f4e24dbaa3e}} 
void {\bfseries set\+\_\+distinct} (bool distinct)
\item 
\mbox{\Hypertarget{classItem__sum_ab0685e05aefcfee71e20d11bcb06e406}\label{classItem__sum_ab0685e05aefcfee71e20d11bcb06e406}} 
int {\bfseries set\+\_\+aggregator} (Aggregator\+::\+Aggregator\+\_\+type aggregator)
\item 
\mbox{\Hypertarget{classItem__sum_a7a25abf6a2e7f8e21b54b6e3e163efb6}\label{classItem__sum_a7a25abf6a2e7f8e21b54b6e3e163efb6}} 
virtual void {\bfseries clear} ()=0
\item 
\mbox{\Hypertarget{classItem__sum_a41c914f3c66a8f4f2f7347d84a5146e7}\label{classItem__sum_a41c914f3c66a8f4f2f7347d84a5146e7}} 
virtual bool {\bfseries add} ()=0
\item 
\mbox{\Hypertarget{classItem__sum_a4be3f81909455d393f78956d701ebe9c}\label{classItem__sum_a4be3f81909455d393f78956d701ebe9c}} 
virtual bool {\bfseries setup} (T\+HD $\ast$thd)
\item 
\mbox{\Hypertarget{classItem__sum_a684aa82ea6a3865ccd33e1d6a35af4df}\label{classItem__sum_a684aa82ea6a3865ccd33e1d6a35af4df}} 
virtual void {\bfseries cleanup} ()
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classItem__sum_a258a11a7a37d6691b29eea7d1a3763ed}\label{classItem__sum_a258a11a7a37d6691b29eea7d1a3763ed}} 
\mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$ {\bfseries ref\+\_\+by}
\item 
\mbox{\Hypertarget{classItem__sum_aebfdf84a6004bd7911e9530667fcf94c}\label{classItem__sum_aebfdf84a6004bd7911e9530667fcf94c}} 
\mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}} $\ast$ {\bfseries next}
\item 
\mbox{\Hypertarget{classItem__sum_ac0b8ea2a1e56beef4716d1dbdd9c3785}\label{classItem__sum_ac0b8ea2a1e56beef4716d1dbdd9c3785}} 
\mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}} $\ast$ {\bfseries in\+\_\+sum\+\_\+func}
\item 
\mbox{\Hypertarget{classItem__sum_ab23f43a29e2173f24250d05afdb3e76c}\label{classItem__sum_ab23f43a29e2173f24250d05afdb3e76c}} 
st\+\_\+select\+\_\+lex $\ast$ {\bfseries aggr\+\_\+sel}
\item 
\mbox{\Hypertarget{classItem__sum_a6ac0e233d4d6559207672c962da4e99b}\label{classItem__sum_a6ac0e233d4d6559207672c962da4e99b}} 
int8 {\bfseries nest\+\_\+level}
\item 
\mbox{\Hypertarget{classItem__sum_ac46d96adf08d77895aaee0fc35b22e31}\label{classItem__sum_ac46d96adf08d77895aaee0fc35b22e31}} 
int8 {\bfseries aggr\+\_\+level}
\item 
\mbox{\Hypertarget{classItem__sum_a254522bb2b44291d437b68702c324b73}\label{classItem__sum_a254522bb2b44291d437b68702c324b73}} 
int8 {\bfseries max\+\_\+arg\+\_\+level}
\item 
\mbox{\Hypertarget{classItem__sum_ae4ed820ab7c0fe088d07e2d9a20f4e4d}\label{classItem__sum_ae4ed820ab7c0fe088d07e2d9a20f4e4d}} 
int8 {\bfseries max\+\_\+sum\+\_\+func\+\_\+level}
\item 
\mbox{\Hypertarget{classItem__sum_af2ad77502fcc4fa45bdcec6ed29d471a}\label{classItem__sum_af2ad77502fcc4fa45bdcec6ed29d471a}} 
bool {\bfseries quick\+\_\+group}
\item 
\mbox{\Hypertarget{classItem__sum_a1d7a6a1ddc9523f7a732689b6e62b9e0}\label{classItem__sum_a1d7a6a1ddc9523f7a732689b6e62b9e0}} 
st\+\_\+select\+\_\+lex $\ast$ \mbox{\hyperlink{classItem__sum_a1d7a6a1ddc9523f7a732689b6e62b9e0}{base\+\_\+select}}
\begin{DoxyCompactList}\small\item\em query block where function is placed \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Static Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
static ulonglong \mbox{\hyperlink{classItem__sum_ad70361f29a92bb55dccd236ddd5e9a53}{ram\+\_\+limitation}} (T\+HD $\ast$thd)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classAggregator}{Aggregator}} $\ast$ \mbox{\hyperlink{classItem__sum_a6ff5bd547facf5c328841cf385e59509}{aggr}}
\item 
\mbox{\Hypertarget{classItem__sum_a1a7743356151cb7a567ff1a39078949f}\label{classItem__sum_a1a7743356151cb7a567ff1a39078949f}} 
uint {\bfseries arg\+\_\+count}
\item 
\mbox{\Hypertarget{classItem__sum_ae77718273b245bde4165dd5ecc201746}\label{classItem__sum_ae77718273b245bde4165dd5ecc201746}} 
\mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$ {\bfseries args}
\item 
\mbox{\Hypertarget{classItem__sum_abe612a6d8a11a53dd6783c6ccef29fe8}\label{classItem__sum_abe612a6d8a11a53dd6783c6ccef29fe8}} 
\mbox{\hyperlink{classItem}{Item}} $\ast$ {\bfseries tmp\+\_\+args} \mbox{[}2\mbox{]}
\item 
\mbox{\Hypertarget{classItem__sum_a058b0e6d479d59d533c2e790b8ae6c7d}\label{classItem__sum_a058b0e6d479d59d533c2e790b8ae6c7d}} 
table\+\_\+map {\bfseries used\+\_\+tables\+\_\+cache}
\item 
\mbox{\Hypertarget{classItem__sum_a67b53e7725198c9280538ca643c88e32}\label{classItem__sum_a67b53e7725198c9280538ca643c88e32}} 
bool {\bfseries forced\+\_\+const}
\end{DoxyCompactItemize}
\subsection*{Friends}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classItem__sum_a40fcb2830e29e49349d865893b6d0b7d}\label{classItem__sum_a40fcb2830e29e49349d865893b6d0b7d}} 
class {\bfseries Aggregator\+\_\+distinct}
\item 
\mbox{\Hypertarget{classItem__sum_aa25c05c6bfa3091d6d165dc8af5fecb8}\label{classItem__sum_aa25c05c6bfa3091d6d165dc8af5fecb8}} 
class {\bfseries Aggregator\+\_\+simple}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Class \mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}} is the base class used for special expressions that S\+QL calls \textquotesingle{}set functions\textquotesingle{}. These expressions are formed with the help of aggregate functions such as S\+UM, M\+AX, G\+R\+O\+U\+P\+\_\+\+C\+O\+N\+C\+AT etc.

G\+E\+N\+E\+R\+AL N\+O\+T\+ES

A set function cannot be used in certain positions where expressions are accepted. There are some quite explicable restrictions for the usage of set functions.

In the query\+: S\+E\+L\+E\+CT A\+V\+G(b) F\+R\+OM t1 W\+H\+E\+RE S\+U\+M(b) $>$ 20 G\+R\+O\+UP by a the usage of the set function A\+V\+G(b) is legal, while the usage of S\+U\+M(b) is illegal. A W\+H\+E\+RE condition must contain expressions that can be evaluated for each row of the table. Yet the expression S\+U\+M(b) can be evaluated only for each group of rows with the same value of column a. In the query\+: S\+E\+L\+E\+CT A\+V\+G(b) F\+R\+OM t1 W\+H\+E\+RE c $>$ 30 G\+R\+O\+UP BY a H\+A\+V\+I\+NG S\+U\+M(b) $>$ 20 both set function expressions A\+V\+G(b) and S\+U\+M(b) are legal.

We can say that in a query without nested selects an occurrence of a set function in an expression of the S\+E\+L\+E\+CT list or/and in the H\+A\+V\+I\+NG clause is legal, while in the W\+H\+E\+RE clause it\textquotesingle{}s illegal.

The general rule to detect whether a set function is legal in a query with nested subqueries is much more complicated.

Consider the the following query\+: S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a $>$ A\+LL (S\+E\+L\+E\+CT t2.\+c F\+R\+OM t2 W\+H\+E\+RE S\+UM(t1.\+b) $<$ t2.\+c). The set function S\+U\+M(b) is used here in the W\+H\+E\+RE clause of the subquery. Nevertheless it is legal since it is under the H\+A\+V\+I\+NG clause of the query to which this function relates. The expression S\+UM(t1.\+b) is evaluated for each group defined in the main query, not for groups of the subquery.

The problem of finding the query where to aggregate a particular set function is not so simple as it seems to be.

In the query\+: S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a $>$ A\+LL(S\+E\+L\+E\+CT t2.\+c F\+R\+OM t2 G\+R\+O\+UP BY t2.\+c H\+A\+V\+I\+NG S\+UM(t1.\+a) $<$ t2.\+c) the set function can be evaluated for both outer and inner selects. If we evaluate S\+UM(t1.\+a) for the outer query then we get the value of t1.\+a multiplied by the cardinality of a group in table t1. In this case in each correlated subquery S\+UM(t1.\+a) is used as a constant. But we also can evaluate S\+UM(t1.\+a) for the inner query. In this case t1.\+a will be a constant for each correlated subquery and summation is performed for each group of table t2. (Here it makes sense to remind that the query S\+E\+L\+E\+CT c F\+R\+OM t G\+R\+O\+UP BY a H\+A\+V\+I\+NG S\+U\+M(1) $<$ a is quite legal in our S\+QL).

So depending on what query we assign the set function to we can get different result sets.

The general rule to detect the query where a set function is to be evaluated can be formulated as follows. Consider a set function S(\+E) where E is an expression with occurrences of column references C1, ..., CN. Resolve these column references against subqueries that contain the set function S(\+E). Let Q be the innermost subquery of those subqueries. (It should be noted here that S(\+E) in no way can be evaluated in the subquery embedding the subquery Q, otherwise S(\+E) would refer to at least one unbound column reference) If S(\+E) is used in a construct of Q where set functions are allowed then we evaluate S(\+E) in Q. Otherwise we look for a innermost subquery containing S(\+E) of those where usage of S(\+E) is allowed.

Let\textquotesingle{}s demonstrate how this rule is applied to the following queries.


\begin{DoxyEnumerate}
\item S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a $>$ A\+LL(S\+E\+L\+E\+CT t2.\+b F\+R\+OM t2 G\+R\+O\+UP BY t2.\+b H\+A\+V\+I\+NG t2.\+b $>$ A\+LL(S\+E\+L\+E\+CT t3.\+c F\+R\+OM t3 G\+R\+O\+UP BY t3.\+c H\+A\+V\+I\+NG S\+UM(t1.\+a+t2.\+b) $<$ t3.\+c)) For this query the set function S\+UM(t1.\+a+t2.\+b) depends on t1.\+a and t2.\+b with t1.\+a defined in the outermost query, and t2.\+b defined for its subquery. The set function is in the H\+A\+V\+I\+NG clause of the subquery and can be evaluated in this subquery.
\item S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a $>$ A\+LL(S\+E\+L\+E\+CT t2.\+b F\+R\+OM t2 W\+H\+E\+RE t2.\+b $>$ A\+LL (S\+E\+L\+E\+CT t3.\+c F\+R\+OM t3 G\+R\+O\+UP BY t3.\+c H\+A\+V\+I\+NG S\+UM(t1.\+a+t2.\+b) $<$ t3.\+c)) Here the set function S\+UM(t1.\+a+t2.\+b)is in the W\+H\+E\+RE clause of the second subquery -\/ the most upper subquery where t1.\+a and t2.\+b are defined. If we evaluate the function in this subquery we violate the context rules. So we evaluate the function in the third subquery (over table t3) where it is used under the H\+A\+V\+I\+NG clause.
\item S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a $>$ A\+LL(S\+E\+L\+E\+CT t2.\+b F\+R\+OM t2 W\+H\+E\+RE t2.\+b $>$ A\+LL (S\+E\+L\+E\+CT t3.\+c F\+R\+OM t3 W\+H\+E\+RE S\+UM(t1.\+a+t2.\+b) $<$ t3.\+c)) In this query evaluation of S\+UM(t1.\+a+t2.\+b) is not legal neither in the second nor in the third subqueries. So this query is invalid.
\end{DoxyEnumerate}

Mostly set functions cannot be nested. In the query S\+E\+L\+E\+CT t1.\+a from t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG A\+VG(S\+UM(t1.\+b)) $>$ 20 the expression S\+U\+M(b) is not acceptable, though it is under a H\+A\+V\+I\+NG clause. Yet it is acceptable in the query\+: S\+E\+L\+E\+CT t.\+1 F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG S\+UM(t1.\+b) $>$ 20.

An argument of a set function does not have to be a reference to a table column as we saw it in examples above. This can be a more complex expression S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG S\+UM(t1.\+b+1) $>$ 20. The expression S\+UM(t1.\+b+1) has a very clear semantics in this context\+: we sum up the values of t1.\+b+1 where t1.\+b varies for all values within a group of rows that contain the same t1.\+a value.

A set function for an outer query yields a constant within a subquery. So the semantics of the query S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a IN (S\+E\+L\+E\+CT t2.\+c F\+R\+OM t2 G\+R\+O\+UP BY t2.\+c H\+A\+V\+I\+NG A\+VG(t2.\+c+S\+UM(t1.\+b)) $>$ 20) is still clear. For a group of the rows with the same t1.\+a values we calculate the value of S\+UM(t1.\+b). This value \textquotesingle{}s\textquotesingle{} is substituted in the the subquery\+: S\+E\+L\+E\+CT t2.\+c F\+R\+OM t2 G\+R\+O\+UP BY t2.\+c H\+A\+V\+I\+NG A\+VG(t2.\+c+s) than returns some result set.

By the same reason the following query with a subquery S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a IN (S\+E\+L\+E\+CT t2.\+c F\+R\+OM t2 G\+R\+O\+UP BY t2.\+c H\+A\+V\+I\+NG A\+VG(S\+UM(t1.\+b)) $>$ 20) is also acceptable.

I\+M\+P\+L\+E\+M\+E\+N\+T\+A\+T\+I\+ON N\+O\+T\+ES

Three methods were added to the class to check the constraints specified in the previous section. These methods utilize several new members.

The field \textquotesingle{}nest\+\_\+level\textquotesingle{} contains the number of the level for the subquery containing the set function. The main S\+E\+L\+E\+CT is of level 0, its subqueries are of levels 1, the subqueries of the latter are of level 2 and so on.

The field \textquotesingle{}aggr\+\_\+level\textquotesingle{} is to contain the nest level of the subquery where the set function is aggregated.

The field \textquotesingle{}max\+\_\+arg\+\_\+level\textquotesingle{} is for the maximun of the nest levels of the unbound column references occurred in the set function. A column reference is unbound within a set function if it is not bound by any subquery used as a subexpression in this function. A column reference is bound by a subquery if it is a reference to the column by which the aggregation of some set function that is used in the subquery is calculated. For the set function used in the query S\+E\+L\+E\+CT t1.\+a F\+R\+OM t1 G\+R\+O\+UP BY t1.\+a H\+A\+V\+I\+NG t1.\+a $>$ A\+LL(S\+E\+L\+E\+CT t2.\+b F\+R\+OM t2 G\+R\+O\+UP BY t2.\+b H\+A\+V\+I\+NG t2.\+b $>$ A\+LL(S\+E\+L\+E\+CT t3.\+c F\+R\+OM t3 G\+R\+O\+UP BY t3.\+c H\+A\+V\+I\+NG S\+UM(t1.\+a+t2.\+b) $<$ t3.\+c)) the value of max\+\_\+arg\+\_\+level is equal to 1 since t1.\+a is bound in the main query, and t2.\+b is bound by the first subquery whose nest level is 1. Obviously a set function cannot be aggregated in the subquery whose nest level is less than max\+\_\+arg\+\_\+level. (Yet it can be aggregated in the subqueries whose nest level is greater than max\+\_\+arg\+\_\+level.) In the query S\+E\+L\+E\+CT t.\+a F\+R\+OM t1 H\+A\+V\+I\+NG A\+VG(t1.\+a+(S\+E\+L\+E\+CT M\+IN(t2.\+c) F\+R\+OM t2)) the value of the max\+\_\+arg\+\_\+level for the A\+VG set function is 0 since the reference t2.\+c is bound in the subquery.

The field \textquotesingle{}max\+\_\+sum\+\_\+func\+\_\+level\textquotesingle{} is to contain the maximum of the nest levels of the set functions that are used as subexpressions of the arguments of the given set function, but not aggregated in any subquery within this set function. A nested set function s1 can be used within set function s0 only if s1.\+max\+\_\+sum\+\_\+func\+\_\+level $<$ s0.\+max\+\_\+sum\+\_\+func\+\_\+level. Set function s1 is considered as nested for set function s0 if s1 is not calculated in any subquery within s0.

A set function that is used as a subexpression in an argument of another set function refers to the latter via the field \textquotesingle{}in\+\_\+sum\+\_\+func\textquotesingle{}.

The condition imposed on the usage of set functions are checked when we traverse query subexpressions with the help of the recursive method fix\+\_\+fields. When we apply this method to an object of the class \mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}}, first, on the descent, we call the method init\+\_\+sum\+\_\+func\+\_\+check that initialize members used at checking. Then, on the ascent, we call the method check\+\_\+sum\+\_\+func that validates the set function usage and reports an error if it is illegal. The method register\+\_\+sum\+\_\+func serves to link the items for the set functions that are aggregated in the embedding (sub)queries. Circular chains of such functions are attached to the corresponding st\+\_\+select\+\_\+lex structures through the field inner\+\_\+sum\+\_\+func\+\_\+list.

Exploiting the fact that the members mentioned above are used in one recursive function we could have allocated them on the thread stack. Yet we don\textquotesingle{}t do it now.

We assume that the nesting level of subquries does not exceed 127. T\+O\+DO\+: to catch queries where the limit is exceeded to make the code clean here. ~\newline
 ~\newline
 

\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classItem__sum_ab22d52290db63c5048f1aa712be2cad7}\label{classItem__sum_ab22d52290db63c5048f1aa712be2cad7}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!Item\+\_\+sum@{Item\+\_\+sum}}
\index{Item\+\_\+sum@{Item\+\_\+sum}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{Item\+\_\+sum()}{Item\_sum()}}
{\footnotesize\ttfamily Item\+\_\+sum\+::\+Item\+\_\+sum (\begin{DoxyParamCaption}\item[{T\+HD $\ast$}]{thd,  }\item[{\mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}} $\ast$}]{item }\end{DoxyParamCaption})}

Constructor used in processing select with temporary tebles. 

\subsection{Member Function Documentation}
\mbox{\Hypertarget{classItem__sum_a469f9e37bdb5f0c186b4fc2190f01fdb}\label{classItem__sum_a469f9e37bdb5f0c186b4fc2190f01fdb}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!aggregate\+\_\+check\+\_\+distinct@{aggregate\+\_\+check\+\_\+distinct}}
\index{aggregate\+\_\+check\+\_\+distinct@{aggregate\+\_\+check\+\_\+distinct}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{aggregate\+\_\+check\+\_\+distinct()}{aggregate\_check\_distinct()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::aggregate\+\_\+check\+\_\+distinct (\begin{DoxyParamCaption}\item[{uchar $\ast$}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{group__AGGREGATE__CHECKS_ga83e75b415b78e10ade375ad320ea446c}{Distinct\+\_\+check\+::check\+\_\+query()}} 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{classItem_a7291ce9a64c0201c71463033b4346df4}{Item}}.

\mbox{\Hypertarget{classItem__sum_acc4dbcc4a2da3750ff11bf372fd973f5}\label{classItem__sum_acc4dbcc4a2da3750ff11bf372fd973f5}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!aggregate\+\_\+check\+\_\+group@{aggregate\+\_\+check\+\_\+group}}
\index{aggregate\+\_\+check\+\_\+group@{aggregate\+\_\+check\+\_\+group}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{aggregate\+\_\+check\+\_\+group()}{aggregate\_check\_group()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::aggregate\+\_\+check\+\_\+group (\begin{DoxyParamCaption}\item[{uchar $\ast$}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{group__AGGREGATE__CHECKS_ga85f98a122e6f9accf528534acb5db686}{Group\+\_\+check\+::check\+\_\+query()}} 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{classItem_ab828d3602e63ad15f5cfd8ff54339189}{Item}}.

\mbox{\Hypertarget{classItem__sum_ab090330ed58167234556e1f906976c0c}\label{classItem__sum_ab090330ed58167234556e1f906976c0c}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!aggregator\+\_\+add@{aggregator\+\_\+add}}
\index{aggregator\+\_\+add@{aggregator\+\_\+add}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{aggregator\+\_\+add()}{aggregator\_add()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::aggregator\+\_\+add (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Called to add value to the aggregator. \mbox{\Hypertarget{classItem__sum_a15e7047e85571842d5aada49784f4278}\label{classItem__sum_a15e7047e85571842d5aada49784f4278}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!aggregator\+\_\+clear@{aggregator\+\_\+clear}}
\index{aggregator\+\_\+clear@{aggregator\+\_\+clear}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{aggregator\+\_\+clear()}{aggregator\_clear()}}
{\footnotesize\ttfamily void Item\+\_\+sum\+::aggregator\+\_\+clear (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Called to cleanup the aggregator. \mbox{\Hypertarget{classItem__sum_ac84fa680a8b3690c6735474c9476f312}\label{classItem__sum_ac84fa680a8b3690c6735474c9476f312}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!aggregator\+\_\+setup@{aggregator\+\_\+setup}}
\index{aggregator\+\_\+setup@{aggregator\+\_\+setup}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{aggregator\+\_\+setup()}{aggregator\_setup()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::aggregator\+\_\+setup (\begin{DoxyParamCaption}\item[{T\+HD $\ast$}]{thd }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Called to initialize the aggregator. \mbox{\Hypertarget{classItem__sum_a6de4d25ee11eb43798effbd4968236bd}\label{classItem__sum_a6de4d25ee11eb43798effbd4968236bd}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!check\+\_\+sum\+\_\+func@{check\+\_\+sum\+\_\+func}}
\index{check\+\_\+sum\+\_\+func@{check\+\_\+sum\+\_\+func}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{check\+\_\+sum\+\_\+func()}{check\_sum\_func()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::check\+\_\+sum\+\_\+func (\begin{DoxyParamCaption}\item[{T\+HD $\ast$}]{thd,  }\item[{\mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$}]{ref }\end{DoxyParamCaption})}

Check constraints imposed on a usage of a set function.

The method verifies whether context conditions imposed on a usage of any set function are met for this occurrence. It checks whether the set function occurs in the position where it can be aggregated and, when it happens to occur in argument of another set function, the method checks that these two functions are aggregated in different subqueries. If the context conditions are not met the method reports an error. If the set function is aggregated in some outer subquery the method adds it to the chain of items for such set functions that is attached to the the st\+\_\+select\+\_\+lex structure for this subquery.

A number of designated members of the object are used to check the conditions. They are specified in the comment before the \mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}} class declaration. Additionally a bitmap variable called allow\+\_\+sum\+\_\+func is employed. It is included into the thd-\/$>$lex structure. The bitmap contains 1 at n-\/th position if the set function happens to occur under a construct of the n-\/th level subquery where usage of set functions are allowed (i.\+e either in the S\+E\+L\+E\+CT list or in the H\+A\+V\+I\+NG clause of the corresponding subquery) Consider the query\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{SELECT SUM(t1.b) FROM t1 GROUP BY t1.a}
\DoxyCodeLine{  HAVING t1.a IN (SELECT t2.c FROM t2 WHERE AVG(t1.b) > 20) AND}
\DoxyCodeLine{         t1.a > (SELECT MIN(t2.d) FROM t2);}
\end{DoxyCode}
 allow\+\_\+sum\+\_\+func will contain\+:
\begin{DoxyItemize}
\item for S\+UM(t1.\+b) -\/ 1 at the first position
\item for A\+VG(t1.\+b) -\/ 1 at the first position, 0 at the second position
\item for M\+IN(t2.\+d) -\/ 1 at the first position, 1 at the second position.
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em thd} & reference to the thread context info \\
\hline
{\em ref} & location of the pointer to this item in the embedding expression\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
This function is to be called for any item created for a set function object when the traversal of trees built for expressions used in the query is performed at the phase of context analysis. This function is to be invoked at the ascent of this traversal.
\end{DoxyNote}

\begin{DoxyRetVals}{Return values}
{\em T\+R\+UE} & if an error is reported \\
\hline
{\em F\+A\+L\+SE} & otherwise \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{classItem__sum_a838d698110f5c45d6ad3ba1c6e5b2a95}\label{classItem__sum_a838d698110f5c45d6ad3ba1c6e5b2a95}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!clean\+\_\+up\+\_\+after\+\_\+removal@{clean\+\_\+up\+\_\+after\+\_\+removal}}
\index{clean\+\_\+up\+\_\+after\+\_\+removal@{clean\+\_\+up\+\_\+after\+\_\+removal}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{clean\+\_\+up\+\_\+after\+\_\+removal()}{clean\_up\_after\_removal()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::clean\+\_\+up\+\_\+after\+\_\+removal (\begin{DoxyParamCaption}\item[{uchar $\ast$}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

Remove the item from the list of inner aggregation functions in the S\+E\+L\+E\+C\+T\+\_\+\+L\+EX it was moved to by \mbox{\hyperlink{classItem__sum_a15a75b6a683912f8222f7091b3714ec8}{Item\+\_\+sum\+::register\+\_\+sum\+\_\+func()}}.

This is done to undo some of the effects of \mbox{\hyperlink{classItem__sum_a15a75b6a683912f8222f7091b3714ec8}{Item\+\_\+sum\+::register\+\_\+sum\+\_\+func()}} so that the item may be removed from the query.

\begin{DoxyNote}{Note}
This doesn\textquotesingle{}t completely undo \mbox{\hyperlink{classItem__sum_a15a75b6a683912f8222f7091b3714ec8}{Item\+\_\+sum\+::register\+\_\+sum\+\_\+func()}}, as with\+\_\+sum\+\_\+func information is left untouched. This means that if this item is removed, aggr\+\_\+sel and all Item\+\_\+subselects between aggr\+\_\+sel and this item may be left with with\+\_\+sum\+\_\+func set to true, even if there are no aggregation functions. To our knowledge, this has no impact on the query result.
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\mbox{\hyperlink{classItem__sum_a15a75b6a683912f8222f7091b3714ec8}{Item\+\_\+sum\+::register\+\_\+sum\+\_\+func()}} 

remove\+\_\+redundant\+\_\+subquery\+\_\+clauses() 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{classItem_a649bf72a4ae639e262d147cf5beaa30a}{Item}}.

\mbox{\Hypertarget{classItem__sum_aeab749252b834e0be4f00aac8ca523f5}\label{classItem__sum_aeab749252b834e0be4f00aac8ca523f5}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!eq@{eq}}
\index{eq@{eq}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{eq()}{eq()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::eq (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classItem}{Item}} $\ast$}]{item,  }\item[{bool}]{binary\+\_\+cmp }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [virtual]}}

\begin{DoxyNote}{Note}
Please keep in sync with \mbox{\hyperlink{classItem__func_a3de3f23377e6f0006dfccd375086365f}{Item\+\_\+func\+::eq()}}. 
\end{DoxyNote}


Reimplemented from \mbox{\hyperlink{classItem_af0957bbdb9a256de0cd29f1adcae28be}{Item}}.

\mbox{\Hypertarget{classItem__sum_ae446ff1dc1d0a43af8a3b57861512d58}\label{classItem__sum_ae446ff1dc1d0a43af8a3b57861512d58}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!get\+\_\+arg\+\_\+ptr@{get\+\_\+arg\+\_\+ptr}}
\index{get\+\_\+arg\+\_\+ptr@{get\+\_\+arg\+\_\+ptr}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{get\+\_\+arg\+\_\+ptr()}{get\_arg\_ptr()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classItem}{Item}}$\ast$$\ast$ Item\+\_\+sum\+::get\+\_\+arg\+\_\+ptr (\begin{DoxyParamCaption}\item[{uint}]{i }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000040}{Todo}}]delete this when we no longer support temporary transformations \end{DoxyRefDesc}
\mbox{\Hypertarget{classItem__sum_a34894a53489b9c2757491908222208bd}\label{classItem__sum_a34894a53489b9c2757491908222208bd}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!init\+\_\+sum\+\_\+func\+\_\+check@{init\+\_\+sum\+\_\+func\+\_\+check}}
\index{init\+\_\+sum\+\_\+func\+\_\+check@{init\+\_\+sum\+\_\+func\+\_\+check}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{init\+\_\+sum\+\_\+func\+\_\+check()}{init\_sum\_func\_check()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::init\+\_\+sum\+\_\+func\+\_\+check (\begin{DoxyParamCaption}\item[{T\+HD $\ast$}]{thd }\end{DoxyParamCaption})}

Prepare an aggregate function item for checking context conditions.

The function initializes the members of the \mbox{\hyperlink{classItem__sum}{Item\+\_\+sum}} object created for a set function that are used to check validity of the set function occurrence. If the set function is not allowed in any subquery where it occurs an error is reported immediately.


\begin{DoxyParams}{Parameters}
{\em thd} & reference to the thread context info\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
This function is to be called for any item created for a set function object when the traversal of trees built for expressions used in the query is performed at the phase of context analysis. This function is to be invoked at the descent of this traversal. 
\end{DoxyNote}

\begin{DoxyRetVals}{Return values}
{\em T\+R\+UE} & if an error is reported \\
\hline
{\em F\+A\+L\+SE} & otherwise \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{classItem__sum_ab44941149d918895e5f58ae94d3cd909}\label{classItem__sum_ab44941149d918895e5f58ae94d3cd909}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!itemize@{itemize}}
\index{itemize@{itemize}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{itemize()}{itemize()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::itemize (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structParse__context}{Parse\+\_\+context}} $\ast$}]{pc,  }\item[{\mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$}]{res }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

The same as contextualize()/contextualize\+\_\+() but with additional parameter

This function finalize the construction of \mbox{\hyperlink{classItem}{Item}} objects (see the \mbox{\hyperlink{classItem}{Item(\+P\+O\+S)}} constructor)\+: we can access/change parser contexts from the \mbox{\hyperlink{classItem__sum_ab44941149d918895e5f58ae94d3cd909}{itemize()}} function.


\begin{DoxyParams}[1]{Parameters}
 & {\em pc} & current parse context \\
\hline
\mbox{\texttt{ out}}  & {\em res} & pointer to \char`\"{}this\char`\"{} or to a newly allocated replacement object to use in the \mbox{\hyperlink{classItem}{Item}} tree instead\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em false} & success \\
\hline
{\em true} & syntax/\+O\+O\+M/etc error \\
\hline
\end{DoxyRetVals}


Reimplemented from \mbox{\hyperlink{classItem_a0757839d09aa77bfd92bfe071f257ae9}{Item}}.



Reimplemented in \mbox{\hyperlink{classItem__func__group__concat_a8f71da39da2da3663cab3357ff4f8e9d}{Item\+\_\+func\+\_\+group\+\_\+concat}}, and \mbox{\hyperlink{classPTI__count__sym_a2e3569aae8364fa95ead6581bd712a87}{P\+T\+I\+\_\+count\+\_\+sym}}.

\mbox{\Hypertarget{classItem__sum_aba62f301a61ca3e686abf23e109bb0a8}\label{classItem__sum_aba62f301a61ca3e686abf23e109bb0a8}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!no\+\_\+rows\+\_\+in\+\_\+result@{no\+\_\+rows\+\_\+in\+\_\+result}}
\index{no\+\_\+rows\+\_\+in\+\_\+result@{no\+\_\+rows\+\_\+in\+\_\+result}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{no\+\_\+rows\+\_\+in\+\_\+result()}{no\_rows\_in\_result()}}
{\footnotesize\ttfamily virtual void Item\+\_\+sum\+::no\+\_\+rows\+\_\+in\+\_\+result (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}

Mark an aggregate as having no rows.

This function is called by the execution engine to assign \textquotesingle{}NO R\+O\+WS F\+O\+U\+ND\textquotesingle{} value to an aggregate item, when the underlying result set has no rows. Such value, in a general case, may be different from the default value of the item after \textquotesingle{}clear()\textquotesingle{}\+: e.\+g. a numeric item may be initialized to 0 by clear() and to N\+U\+LL by \mbox{\hyperlink{classItem__sum_aba62f301a61ca3e686abf23e109bb0a8}{no\+\_\+rows\+\_\+in\+\_\+result()}}. 

Reimplemented from \mbox{\hyperlink{classItem}{Item}}.



Reimplemented in \mbox{\hyperlink{classItem__func__group__concat_a89dcd722bccaa2c1b16d972ce823087f}{Item\+\_\+func\+\_\+group\+\_\+concat}}, \mbox{\hyperlink{classItem__sum__hybrid_a7b06af139e0b7f7b0153252aa8f2e992}{Item\+\_\+sum\+\_\+hybrid}}, \mbox{\hyperlink{classItem__sum__variance_a510a0268827bac0bf1fc4cf933813745}{Item\+\_\+sum\+\_\+variance}}, \mbox{\hyperlink{classItem__sum__avg_ab4cfa5a3c42abc40f7f3fdb95c92d568}{Item\+\_\+sum\+\_\+avg}}, \mbox{\hyperlink{classItem__sum__count_a74ba6f4c6812411fa43d9d942d949863}{Item\+\_\+sum\+\_\+count}}, and \mbox{\hyperlink{classItem__sum__sum_aa610e5d4e5371dcea4625416d7d79d93}{Item\+\_\+sum\+\_\+sum}}.

\mbox{\Hypertarget{classItem__sum_a0c176fad01253e4a168d0956eb1f6fc5}\label{classItem__sum_a0c176fad01253e4a168d0956eb1f6fc5}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!print@{print}}
\index{print@{print}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{print()}{print()}}
{\footnotesize\ttfamily void Item\+\_\+sum\+::print (\begin{DoxyParamCaption}\item[{String $\ast$}]{str,  }\item[{enum\+\_\+query\+\_\+type}]{query\+\_\+type }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

This method is used for to\+:
\begin{DoxyItemize}
\item to generate a view definition query (S\+E\+L\+E\+CT-\/statement);
\item to generate a S\+QL-\/query for E\+X\+P\+L\+A\+IN E\+X\+T\+E\+N\+D\+ED;
\item to generate a S\+QL-\/query to be shown in I\+N\+F\+O\+R\+M\+A\+T\+I\+O\+N\+\_\+\+S\+C\+H\+E\+MA;
\item to generate a S\+QL-\/query that looks like a prepared statement for query\+\_\+rewrite
\item debug.
\end{DoxyItemize}

For more information about view definition query, I\+N\+F\+O\+R\+M\+A\+T\+I\+O\+N\+\_\+\+S\+C\+H\+E\+MA query and why they should be generated from the \mbox{\hyperlink{classItem}{Item}}-\/tree, \begin{DoxySeeAlso}{See also}
mysql\+\_\+register\+\_\+view(). 
\end{DoxySeeAlso}


Reimplemented from \mbox{\hyperlink{classItem_aa7ba4bde739d83adec8edf3bf1596d94}{Item}}.



Reimplemented in \mbox{\hyperlink{classItem__func__group__concat_aec51f14b9c22c61d5ac4e58add30365b}{Item\+\_\+func\+\_\+group\+\_\+concat}}.

\mbox{\Hypertarget{classItem__sum_ad70361f29a92bb55dccd236ddd5e9a53}\label{classItem__sum_ad70361f29a92bb55dccd236ddd5e9a53}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!ram\+\_\+limitation@{ram\+\_\+limitation}}
\index{ram\+\_\+limitation@{ram\+\_\+limitation}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{ram\+\_\+limitation()}{ram\_limitation()}}
{\footnotesize\ttfamily ulonglong Item\+\_\+sum\+::ram\+\_\+limitation (\begin{DoxyParamCaption}\item[{T\+HD $\ast$}]{thd }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [protected]}}

Calculate the affordable R\+AM limit for structures like T\+R\+EE or \mbox{\hyperlink{classUnique}{Unique}} used in Item\+\_\+sum\+\_\+$\ast$ \mbox{\Hypertarget{classItem__sum_a15a75b6a683912f8222f7091b3714ec8}\label{classItem__sum_a15a75b6a683912f8222f7091b3714ec8}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!register\+\_\+sum\+\_\+func@{register\+\_\+sum\+\_\+func}}
\index{register\+\_\+sum\+\_\+func@{register\+\_\+sum\+\_\+func}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{register\+\_\+sum\+\_\+func()}{register\_sum\_func()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::register\+\_\+sum\+\_\+func (\begin{DoxyParamCaption}\item[{T\+HD $\ast$}]{thd,  }\item[{\mbox{\hyperlink{classItem}{Item}} $\ast$$\ast$}]{ref }\end{DoxyParamCaption})}

Attach a set function to the subquery where it must be aggregated.

The function looks for an outer subquery where the set function must be aggregated. If it finds such a subquery then aggr\+\_\+level is set to the nest level of this subquery and the item for the set function is added to the list of set functions used in nested subqueries inner\+\_\+sum\+\_\+func\+\_\+list defined for each subquery. When the item is placed there the field \textquotesingle{}ref\+\_\+by\textquotesingle{} is set to ref.

\begin{DoxyNote}{Note}
Now we \textquotesingle{}register\textquotesingle{} only set functions that are aggregated in outer subqueries. Actually it makes sense to link all set function for a subquery in one chain. It would simplify the process of \textquotesingle{}splitting\textquotesingle{} for set functions.
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em thd} & reference to the thread context info \\
\hline
{\em ref} & location of the pointer to this item in the embedding expression\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em F\+A\+L\+SE} & if the executes without failures (currently always) \\
\hline
{\em T\+R\+UE} & otherwise \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{classItem__sum_a5d29c1ad81ae5e0193775cb360f4a74a}\label{classItem__sum_a5d29c1ad81ae5e0193775cb360f4a74a}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!reset\+\_\+and\+\_\+add@{reset\+\_\+and\+\_\+add}}
\index{reset\+\_\+and\+\_\+add@{reset\+\_\+and\+\_\+add}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{reset\+\_\+and\+\_\+add()}{reset\_and\_add()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::reset\+\_\+and\+\_\+add (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Resets the aggregate value to its default and aggregates the current value of its attribute(s). \mbox{\Hypertarget{classItem__sum_ae323b192d183b3f85bbee92c43685310}\label{classItem__sum_ae323b192d183b3f85bbee92c43685310}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!walk@{walk}}
\index{walk@{walk}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{walk()}{walk()}}
{\footnotesize\ttfamily bool Item\+\_\+sum\+::walk (\begin{DoxyParamCaption}\item[{Item\+\_\+processor}]{processor,  }\item[{\mbox{\hyperlink{classItem_a4e68f315ba2a26543339e9f0efed3695}{enum\+\_\+walk}}}]{walk,  }\item[{uchar $\ast$}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

Traverses a tree of Items in prefix and/or postfix order. Optionally walks into subqueries.


\begin{DoxyParams}{Parameters}
{\em processor} & processor function to be invoked per item returns true to abort traversal, false to continue \\
\hline
{\em walk} & controls how to traverse the item tree W\+A\+L\+K\+\_\+\+P\+R\+E\+F\+IX\+: call processor before invoking children W\+A\+L\+K\+\_\+\+P\+O\+S\+T\+F\+IX\+: call processor after invoking children W\+A\+L\+K\+\_\+\+S\+U\+B\+Q\+U\+E\+RY go down into subqueries walk values are bit-\/coded and may be combined. Omitting both W\+A\+L\+K\+\_\+\+P\+R\+E\+F\+IX and W\+A\+L\+K\+\_\+\+P\+O\+S\+T\+F\+IX is undefined behaviour. \\
\hline
{\em arg} & Optional pointer to a walk-\/specific object\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em false} & walk succeeded \\
\hline
{\em true} & walk aborted by agreement, an error may have been reported \\
\hline
\end{DoxyRetVals}


Reimplemented from \mbox{\hyperlink{classItem_ab7d2529511c14a77e59a1b1bbabc95d7}{Item}}.



\subsection{Member Data Documentation}
\mbox{\Hypertarget{classItem__sum_a6ff5bd547facf5c328841cf385e59509}\label{classItem__sum_a6ff5bd547facf5c328841cf385e59509}} 
\index{Item\+\_\+sum@{Item\+\_\+sum}!aggr@{aggr}}
\index{aggr@{aggr}!Item\+\_\+sum@{Item\+\_\+sum}}
\subsubsection{\texorpdfstring{aggr}{aggr}}
{\footnotesize\ttfamily \mbox{\hyperlink{classAggregator}{Aggregator}}$\ast$ Item\+\_\+sum\+::aggr\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\hyperlink{classAggregator}{Aggregator}} class instance. Not set initially. Allocated only after it is determined if the incoming data are already distinct. 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
item\+\_\+sum.\+h\item 
\mbox{\hyperlink{item__sum_8cc}{item\+\_\+sum.\+cc}}\end{DoxyCompactItemize}
