<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: json_dom.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">json_dom.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;my_global.h&quot;</code><br />
<code>#include &quot;malloc_allocator.h&quot;</code><br />
<code>#include &quot;<a class="el" href="my__decimal_8h_source.html">my_decimal.h</a>&quot;</code><br />
<code>#include &quot;binary_log_types.h&quot;</code><br />
<code>#include &quot;my_time.h&quot;</code><br />
<code>#include &quot;mysql_time.h&quot;</code><br />
<code>#include &quot;<a class="el" href="json__binary_8h_source.html">json_binary.h</a>&quot;</code><br />
<code>#include &quot;sql_alloc.h&quot;</code><br />
<code>#include &quot;sql_error.h&quot;</code><br />
<code>#include &quot;prealloced_array.h&quot;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
</div>
<p><a href="json__dom_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__dom.html">Json_dom</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structJson__key__comparator.html">Json_key_comparator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__object.html">Json_object</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__array.html">Json_array</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__scalar.html">Json_scalar</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__string.html">Json_string</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__number.html">Json_number</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__decimal.html">Json_decimal</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__double.html">Json_double</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__int.html">Json_int</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__uint.html">Json_uint</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__null.html">Json_null</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__datetime.html">Json_datetime</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__opaque.html">Json_opaque</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__boolean.html">Json_boolean</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__wrapper__object__iterator.html">Json_wrapper_object_iterator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classJson__wrapper.html">Json_wrapper</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a9e0d6d40c86dcaf14198961c176068b7"><td class="memItemLeft" align="right" valign="top"><a id="a9e0d6d40c86dcaf14198961c176068b7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="json__dom_8h.html#a9e0d6d40c86dcaf14198961c176068b7">JSON_DOCUMENT_MAX_DEPTH</a>&#160;&#160;&#160;100</td></tr>
<tr class="memdesc:a9e0d6d40c86dcaf14198961c176068b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum number of nesting levels allowed in a JSON document. <br /></td></tr>
<tr class="separator:a9e0d6d40c86dcaf14198961c176068b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a78a8f3d31c814515ae7cc593bca75a59"><td class="memItemLeft" align="right" valign="top"><a id="a78a8f3d31c814515ae7cc593bca75a59"></a>
typedef Prealloced_array&lt; <a class="el" href="classJson__wrapper.html">Json_wrapper</a>, 16, false &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>Json_wrapper_vector</b></td></tr>
<tr class="separator:a78a8f3d31c814515ae7cc593bca75a59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15dead9cb1bfe2e737468f0fad9e2b70"><td class="memItemLeft" align="right" valign="top"><a id="a15dead9cb1bfe2e737468f0fad9e2b70"></a>
typedef Prealloced_array&lt; <a class="el" href="classJson__dom.html">Json_dom</a> *, 16 &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>Json_dom_vector</b></td></tr>
<tr class="separator:a15dead9cb1bfe2e737468f0fad9e2b70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe717bc1839c6f504624dec1e85062c5"><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; std::string, <a class="el" href="classJson__dom.html">Json_dom</a> *, <a class="el" href="structJson__key__comparator.html">Json_key_comparator</a>, <a class="el" href="classMalloc__allocator.html">Malloc_allocator</a>&lt; std::pair&lt; const std::string, <a class="el" href="classJson__dom.html">Json_dom</a> * &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="json__dom_8h.html#abe717bc1839c6f504624dec1e85062c5">Json_object_map</a></td></tr>
<tr class="separator:abe717bc1839c6f504624dec1e85062c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77a73063f3883573ce190fab4523f27d"><td class="memItemLeft" align="right" valign="top"><a id="a77a73063f3883573ce190fab4523f27d"></a>
typedef bool *&#160;</td><td class="memItemRight" valign="bottom"><b>warning_method</b>(<a class="el" href="classSql__condition.html#ab0602581e19cddb609bfe10c44be4e83">Sql_condition::enum_severity_level</a>, unsigned int, int)</td></tr>
<tr class="separator:a77a73063f3883573ce190fab4523f27d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad5150927a04c19e60622eb3365975c18"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="json__dom_8h.html#ad5150927a04c19e60622eb3365975c18">double_quote</a> (const char *cptr, size_t length, String *buf)</td></tr>
<tr class="separator:ad5150927a04c19e60622eb3365975c18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3afb1a174363a8942fc6cb0fc2f493e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classJson__dom.html">Json_dom</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="json__dom_8h.html#ae3afb1a174363a8942fc6cb0fc2f493e">merge_doms</a> (<a class="el" href="classJson__dom.html">Json_dom</a> *left, <a class="el" href="classJson__dom.html">Json_dom</a> *right)</td></tr>
<tr class="separator:ae3afb1a174363a8942fc6cb0fc2f493e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e1321856fbcd3a52b6a7b5b0c621392"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="json__dom_8h.html#a4e1321856fbcd3a52b6a7b5b0c621392">is_valid_json_syntax</a> (const char *text, size_t length)</td></tr>
<tr class="separator:a4e1321856fbcd3a52b6a7b5b0c621392"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p class="">When a JSON value is retrieved from a column, a prior it exists in a binary form, cf. Json_binary::Value class. </p>
<p class="">However, when we need to manipulate the JSON values we mostly convert them from binary form to a structured in-memory from called DOM (from domain object model) which uses a recursive tree representation of the JSON value corresponding closely to a parse tree. This form is more suitable for manipulation. </p>
<p class="">The JSON type is mostly represented internally as a <a class="el" href="classJson__wrapper.html">Json_wrapper</a> which hides if the representation is a binary or DOM one. This makes is possible to avoid building a DOM unless we really need one. </p>
<p class="">The file defines two sets of classes: a) The <a class="el" href="classJson__dom.html">Json_dom</a> hierarchy and b) <a class="el" href="classJson__wrapper.html">Json_wrapper</a> and its companion class <a class="el" href="classJson__wrapper__object__iterator.html">Json_wrapper_object_iterator</a>. For both sets, arrays are traversed using an operator[]. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="abe717bc1839c6f504624dec1e85062c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe717bc1839c6f504624dec1e85062c5">&#9670;&nbsp;</a></span>Json_object_map</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;std::string, <a class="el" href="classJson__dom.html">Json_dom</a> *, <a class="el" href="structJson__key__comparator.html">Json_key_comparator</a>, <a class="el" href="classMalloc__allocator.html">Malloc_allocator</a>&lt;std::pair&lt;const std::string, <a class="el" href="classJson__dom.html">Json_dom</a> *&gt; &gt; &gt; <a class="el" href="json__dom_8h.html#abe717bc1839c6f504624dec1e85062c5">Json_object_map</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p class="">A type used to hold JSON object elements in a map, see the <a class="el" href="classJson__object.html">Json_object</a> class. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad5150927a04c19e60622eb3365975c18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5150927a04c19e60622eb3365975c18">&#9670;&nbsp;</a></span>double_quote()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool double_quote </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p class="">Function for double-quoting a string and escaping characters to make up a valid EMCA Json text.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cptr</td><td>the unquoted character string </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>its length </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">buf</td><td>the destination buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>false on success, true on error</dd></dl>
<p>Perform quoting on a JSON string to make an external representation of it. it wraps double quotes (text quotes) around the string (cptr) an also performs escaping according to the following table: </p><pre>
Common name     C-style  Original unescaped     Transformed to
                escape   UTF-8 bytes            escape sequence
<h2>notation                        in UTF-8 bytes
</h2>
</pre><pre>
quote           "       x22                    x5C x22
backslash       \       x5C                    x5C x5C
backspace       <b>x08</b> x5C x62
formfeed               x0C                    x5C x66
linefeed        <br />
       x0A                    x5C x6E
carriage-return        x0D                    x5C x72
tab                    x09                    x5C x74
unicode           A hex number in the      x5C x75
                        range of 00-1F,          followed by
                        except for the ones      4 hex digits
                        handled above (backspace,
                        formfeed, linefeed,
                        carriage-return,
<h2>and tab).
</h2>
</pre><pre>
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cptr</td><td>pointer to string data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>the length of the string </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">buf</td><td>the destination buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">false</td><td>on success </td></tr>
    <tr><td class="paramname">true</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4e1321856fbcd3a52b6a7b5b0c621392"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e1321856fbcd3a52b6a7b5b0c621392">&#9670;&nbsp;</a></span>is_valid_json_syntax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool is_valid_json_syntax </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p class="">Check if a string contains valid JSON text, without generating a <a class="el" href="classJson__dom.html">Json_dom</a> representation of the document.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">text</td><td>pointer to the beginning of the string </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>the length of the string </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the string is valid JSON text, false otherwise </dd></dl>

</div>
</div>
<a id="ae3afb1a174363a8942fc6cb0fc2f493e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3afb1a174363a8942fc6cb0fc2f493e">&#9670;&nbsp;</a></span>merge_doms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classJson__dom.html">Json_dom</a>* merge_doms </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classJson__dom.html">Json_dom</a> *&#160;</td>
          <td class="paramname"><em>left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classJson__dom.html">Json_dom</a> *&#160;</td>
          <td class="paramname"><em>right</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p class="">Merge two doms. The right dom is either subsumed into the left dom or the contents of the right dom are transferred to the left dom and the right dom is deleted. After calling this function, the caller should not reference the right dom again. It has been deleted.</p>
<p class="">Returns NULL if there is a memory allocation failure. In this case both doms are deleted.</p>
<p class="">scalars - If any of the documents that are being merged is a scalar, each scalar document is autowrapped as a single value array before merging.</p>
<p class="">arrays - When merging a left array with a right array, then the result is the left array concatenated with the right array. For instance, [ 1, 2 ] merged with [ 3, 4 ] is [ 1, 2, 3, 4 ].</p>
<p class="">array and object - When merging an array with an object, the object is autowrapped as an array and then the rule above is applied. So [ 1, 2 ] merged with { "a" : true } is [ 1, 2, { "a": true } ].</p>
<p class="">objects - When merging two objects, the two objects are concatenated into a single, larger object. So { "a" : "foo" } merged with { "b" : 5 } is { "a" : "foo", "b" : 5 }.</p>
<p class="">duplicates - When two objects are merged and they share a key, the values associated with the shared key are merged.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">left</td><td>[inout] The recipient dom. </td></tr>
    <tr><td class="paramname">right</td><td>[inout] The dom to be consumed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A composite dom which subsumes the left and right doms, or NULL if a failure happened while merging </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
